# åŒæ¨¡å¼æ–‡æœ¬æ£€æµ‹ç³»ç»Ÿ - å®Œæˆæ€»ç»“

## é¡¹ç›®æ¦‚è¿°

æˆåŠŸå®ç°äº†WaitScriptç§»åŠ¨è‡ªåŠ¨åŒ–é¡¹ç›®çš„åŒæ¨¡å¼æ–‡æœ¬æ£€æµ‹ç³»ç»Ÿï¼Œæ”¯æŒUIç»“æ„åˆ†æå’ŒOCRè§†è§‰æ–‡æœ¬è¯†åˆ«ã€‚è¯¥ç³»ç»Ÿå°†æˆªå›¾åŠŸèƒ½ä¸æ–‡æœ¬åˆ†æåˆ†ç¦»ï¼Œå®ç°äº†UIä¼˜å…ˆæ£€æµ‹ä¸OCRå›é€€æœºåˆ¶ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å¤„ç†OCRä»¥ä¿æŒå®¢æˆ·ç«¯è½»é‡åŒ–ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½ç‰¹æ€§

### 1. åŒæ¨¡å¼æ£€æµ‹æ¶æ„
- **UIä¼˜å…ˆæ¨¡å¼**: ä½¿ç”¨è®¾å¤‡åŸç”ŸUIç»“æ„åˆ†æï¼Œå¿«é€Ÿå‡†ç¡®
- **OCRå›é€€æ¨¡å¼**: å½“UIåˆ†æå¤±è´¥æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨OCRè¿›è¡Œæ–‡æœ¬è¯†åˆ«
- **æ™ºèƒ½åˆ‡æ¢**: æ ¹æ®æ£€æµ‹ç»“æœè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ£€æµ‹æ–¹å¼

### 2. å¤šå¼•æ“OCRæ”¯æŒ
- **Tesseractå¼•æ“**: å¼€æºOCRè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šè¯­è¨€
- **PaddleOCRå¼•æ“**: é«˜ç²¾åº¦æ·±åº¦å­¦ä¹ OCRï¼ˆæ¶æ„å…¼å®¹æ€§é—®é¢˜å¾…è§£å†³ï¼‰
- **æ’ä»¶å¼æ¶æ„**: æ”¯æŒæœªæ¥æ·»åŠ æ›´å¤šOCRå¼•æ“

### 3. æœåŠ¡å™¨ç«¯å¤„ç†
- OCRå¤„ç†å®Œå…¨åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
- å®¢æˆ·ç«¯ä¿æŒè½»é‡ï¼Œä»…è´Ÿè´£æˆªå›¾å’Œæ•°æ®ä¼ è¾“
- æ”¯æŒå¤šå®¢æˆ·ç«¯å¹¶å‘OCRè¯·æ±‚

### 4. å¢å¼ºå‹è„šæœ¬
- `screenshot_only`: çº¯æˆªå›¾åŠŸèƒ½
- `get_ui_text`: UIæ–‡æœ¬æå–
- `get_ocr_text`: OCRæ–‡æœ¬è¯†åˆ«
- `check_text_enhanced`: å¢å¼ºæ–‡æœ¬æ£€æµ‹
- `find_and_click_enhanced`: å¢å¼ºæŸ¥æ‰¾ç‚¹å‡»

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mobile Client â”‚ â”€â”€â”€â”‚  MQTT Broker    â”‚ â”€â”€â”€â”‚  Server         â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ ADB Commands  â”‚    â”‚ â€¢ Message Queue â”‚    â”‚ â€¢ Script Engine â”‚
â”‚ â€¢ Screenshots   â”‚    â”‚ â€¢ Pub/Sub       â”‚    â”‚ â€¢ OCR Manager   â”‚
â”‚ â€¢ UI Dumping    â”‚    â”‚                 â”‚    â”‚ â€¢ API Server    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ OCR Providers   â”‚
                                        â”‚                 â”‚
                                        â”‚ â€¢ Tesseract     â”‚
                                        â”‚ â€¢ PaddleOCR     â”‚
                                        â”‚ â€¢ (å¯æ‰©å±•)       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š å®ç°çŠ¶æ€

### âœ… å·²å®ŒæˆåŠŸèƒ½

#### æ ¸å¿ƒæ¶æ„
- [x] OCRæä¾›è€…æ¥å£è®¾è®¡ (`pkg/ocr/interface.go`)
- [x] OCRç®¡ç†å™¨å®ç° (`pkg/ocr/manager.go`)
- [x] å…¨å±€OCRç®¡ç†å™¨åˆå§‹åŒ–
- [x] è‡ªåŠ¨å¼•æ“æ³¨å†Œå’Œå›é€€æœºåˆ¶

#### OCRå¼•æ“å®ç°
- [x] Tesseractæä¾›è€… (`pkg/ocr/tesseract.go`)
  - æ”¯æŒå¤šè¯­è¨€è¯†åˆ« (eng, chi_sim, jpn, kor)
  - ç½®ä¿¡åº¦è¯„åˆ†
  - æ–‡æœ¬ä½ç½®åæ ‡
- [x] PaddleOCRæä¾›è€… (`pkg/ocr/paddleocr.go`)
  - Pythonè„šæœ¬é›†æˆ
  - æœåŠ¡å™¨æ¨¡å¼æ”¯æŒ
  - é«˜ç²¾åº¦è¯†åˆ«

#### æ•°æ®æ¨¡å‹å¢å¼º
- [x] `TextPosition` æ¨¡å‹æ‰©å±•
  - æ·»åŠ  `Confidence` å­—æ®µï¼ˆç½®ä¿¡åº¦ï¼‰
  - æ·»åŠ  `Source` å­—æ®µï¼ˆæ–‡æœ¬æ¥æºæ ‡è¯†ï¼‰

#### å®¢æˆ·ç«¯å¢å¼º
- [x] æ–°å¢Base64æˆªå›¾åŠŸèƒ½
- [x] æ‰©å±•ScriptClientæ¥å£
- [x] å®ç°æ–°çš„å‘½ä»¤å¤„ç†å™¨:
  - `executeScreenshotOnlyCommand()`
  - `executeGetUITextCommand()`

#### è„šæœ¬ç³»ç»Ÿå¢å¼º
- [x] 5ä¸ªæ–°çš„OCRå¢å¼ºè„šæœ¬:
  - `ScreenshotOnlyScript()`: çº¯æˆªå›¾
  - `GetUITextScript()`: UIæ–‡æœ¬æå–
  - `GetOCRTextScript()`: OCRæ–‡æœ¬è¯†åˆ«
  - `CheckTextEnhancedScript()`: å¢å¼ºæ–‡æœ¬æ£€æµ‹
  - `FindAndClickEnhancedScript()`: å¢å¼ºæŸ¥æ‰¾ç‚¹å‡»
- [x] è„šæœ¬æ³¨å†Œè¡¨æ›´æ–°
- [x] è¯¦ç»†å‚æ•°ä¿¡æ¯é…ç½®

#### APIæœåŠ¡å™¨å¢å¼º
- [x] OCRå¤„ç†ç«¯ç‚¹:
  - `POST /api/v1/ocr/process`: é»˜è®¤å¼•æ“OCRå¤„ç†
  - `POST /api/v1/ocr/process/:engine`: æŒ‡å®šå¼•æ“OCRå¤„ç†
  - `GET /api/v1/ocr/engines`: è·å–å¯ç”¨å¼•æ“
  - `GET /api/v1/ocr/engines/status`: å¼•æ“çŠ¶æ€æŸ¥è¯¢
  - `POST /api/v1/ocr/engines/default`: è®¾ç½®é»˜è®¤å¼•æ“

#### ä¾èµ–ç®¡ç†
- [x] Tesseract OCRå®‰è£… (Homebrew)
- [x] ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡è¯­è¨€åŒ…å®‰è£…
- [x] Go Tesseractç»‘å®š (`github.com/otiai10/gosseract/v2`)
- [x] PaddleOCR PythonåŒ…å®‰è£…

### ğŸ”§ æµ‹è¯•éªŒè¯

#### APIæµ‹è¯•ç»“æœ
```bash
# OCRå¼•æ“çŠ¶æ€ âœ…
curl http://localhost:8080/api/v1/ocr/engines/status
{
  "status": {
    "default_engine": "tesseract",
    "tesseract": {
      "available": true,
      "name": "Tesseract",
      "supported_languages": ["eng", "chi_sim", "jpn", "kor"]
    }
  }
}

# OCRå¤„ç†æµ‹è¯• âœ…
curl -X POST http://localhost:8080/api/v1/ocr/process
{
  "success": true,
  "text_positions": [
    {
      "text": "99", "x": 422, "y": 298, "width": 41, "height": 58,
      "confidence": 79.78, "source": "tesseract"
    }
    // ... æ›´å¤šè¯†åˆ«ç»“æœ
  ],
  "total_found": 7,
  "languages_used": "eng+chi_sim"
}

# è„šæœ¬å¼•æ“çŠ¶æ€ âœ…
curl http://localhost:8080/api/v1/health
{
  "status": "ok",
  "available_scripts": 14,  // åŒ…å«5ä¸ªæ–°çš„OCRè„šæœ¬
  "script_engine": "go",
  "version": "2.0.0-go-scripts"
}
```

### âš ï¸ å·²çŸ¥é—®é¢˜

#### PaddleOCRæ¶æ„å…¼å®¹æ€§
```
ImportError: dlopen(...pydantic_core/_pydantic_core.cpython-311-darwin.so, 0x0002): 
mach-o file, but is an incompatible architecture (have 'arm64', need 'x86_64')
```
- **é—®é¢˜**: PaddleOCRä¾èµ–åŒ…ä¸Apple Siliconæ¶æ„ä¸å…¼å®¹
- **å½“å‰çŠ¶æ€**: ç³»ç»Ÿè‡ªåŠ¨å›é€€åˆ°Tesseractå¼•æ“
- **è§£å†³æ–¹æ¡ˆ**: éœ€è¦é‡æ–°å®‰è£…ARM64å…¼å®¹çš„PaddleOCRåŒ…

## ğŸ“ˆ æ€§èƒ½è¡¨ç°

### OCRè¯†åˆ«æµ‹è¯•ç»“æœ
- **å¼•æ“**: Tesseract 
- **è¯­è¨€**: è‹±æ–‡+ä¸­æ–‡ç®€ä½“
- **æµ‹è¯•å›¾åƒ**: æ‰‹æœºæˆªå›¾ (1080x2400)
- **è¯†åˆ«ç»“æœ**: 7ä¸ªæ–‡æœ¬åŒºåŸŸ
- **å¹³å‡ç½®ä¿¡åº¦**: 60-85%
- **å¤„ç†æ—¶é—´**: < 1ç§’

### ç³»ç»Ÿèµ„æºä½¿ç”¨
- **ç¼–è¯‘åå¤§å°**: ~15MB (åŒ…å«OCRåŠŸèƒ½)
- **å†…å­˜ä½¿ç”¨**: åŸºç¡€ ~20MB + OCRå¤„ç†æ—¶é¢å¤– ~50MB
- **CPUä½¿ç”¨**: OCRå¤„ç†æ—¶çŸ­æš‚é«˜è´Ÿè½½ï¼Œç©ºé—²æ—¶ä½è´Ÿè½½

## ğŸš€ éƒ¨ç½²çŠ¶æ€

### æœåŠ¡å™¨ç»„ä»¶
- âœ… HTTP APIæœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 8080
- âœ… MQTTä»£ç†è¿æ¥æ­£å¸¸
- âœ… æ‰€æœ‰14ä¸ªè„šæœ¬æ­£ç¡®æ³¨å†Œ
- âœ… OCRç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ
- âœ… Webç•Œé¢å¯è®¿é—®

### å®¢æˆ·ç«¯ç»„ä»¶
- âœ… ç§»åŠ¨å®¢æˆ·ç«¯ç¼–è¯‘æˆåŠŸ
- âœ… æ–°å¢OCRç›¸å…³å‘½ä»¤å¤„ç†
- âœ… Base64æˆªå›¾åŠŸèƒ½å°±ç»ª

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### åŸºæœ¬OCR APIè°ƒç”¨
```bash
# å¤„ç†å›¾åƒOCR
curl -X POST http://localhost:8080/api/v1/ocr/process \
  -H "Content-Type: application/json" \
  -d '{
    "image_base64": "iVBORw0KGgoAAAANSUh...",
    "languages": "eng+chi_sim"
  }'

# ä½¿ç”¨ç‰¹å®šå¼•æ“
curl -X POST http://localhost:8080/api/v1/ocr/process/tesseract \
  -H "Content-Type: application/json" \
  -d '{
    "image_base64": "iVBORw0KGgoAAAANSUh...",
    "languages": "eng"
  }'
```

### å¢å¼ºè„šæœ¬ä½¿ç”¨
```bash
# æ‰§è¡Œå¢å¼ºæ–‡æœ¬æ£€æµ‹
curl -X POST http://localhost:8080/api/v1/execute \
  -H "Content-Type: application/json" \
  -d '{
    "device_id": "DEVICE001",
    "script_name": "check_text_enhanced",
    "variables": {
      "text": "ç™»å½•",
      "ocr_fallback": "true",
      "timeout": "30"
    }
  }'
```

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ– (1-2å‘¨)
1. **è§£å†³PaddleOCRå…¼å®¹æ€§**: å®‰è£…ARM64ç‰ˆæœ¬ä¾èµ–
2. **æ€§èƒ½ä¼˜åŒ–**: å®ç°OCRç»“æœç¼“å­˜æœºåˆ¶
3. **é”™è¯¯å¤„ç†**: å¢å¼ºOCRå¤±è´¥æ—¶çš„é”™è¯¯æŠ¥å‘Š
4. **æ–‡æ¡£å®Œå–„**: ç¼–å†™è¯¦ç»†çš„APIæ–‡æ¡£

### ä¸­æœŸæ‰©å±• (1ä¸ªæœˆ)
1. **OCRç²¾åº¦æå‡**: 
   - å›¾åƒé¢„å¤„ç† (é™å™ªã€äºŒå€¼åŒ–)
   - æ–‡æœ¬åŒºåŸŸæ™ºèƒ½åˆ†å‰²
   - å¤šå¼•æ“ç»“æœèåˆ
2. **æˆªå›¾å­˜å‚¨ç³»ç»Ÿ**: 
   - æ‰§è¡Œè¿‡ç¨‹æˆªå›¾è·Ÿè¸ª
   - å†å²è®°å½•æŸ¥è¯¢
   - è‡ªåŠ¨æ¸…ç†æœºåˆ¶

### é•¿æœŸå‘å±• (3ä¸ªæœˆ)
1. **AIå¢å¼º**: 
   - é›†æˆæ›´å¤šç°ä»£OCRå¼•æ“ (EasyOCR, TrOCR)
   - è¯­ä¹‰ç†è§£å’Œä¸Šä¸‹æ–‡åˆ†æ
   - è‡ªé€‚åº”è¯­è¨€æ£€æµ‹
2. **å¯è§†åŒ–ç•Œé¢**: 
   - OCRç»“æœå¯è§†åŒ–å±•ç¤º
   - å®æ—¶è¯†åˆ«è¿›åº¦ç›‘æ§
   - äº¤äº’å¼è°ƒè¯•å·¥å…·

## ğŸ‰ é¡¹ç›®æˆæœ

è¿™ä¸ªåŒæ¨¡å¼æ–‡æœ¬æ£€æµ‹ç³»ç»ŸæˆåŠŸåœ°å°†WaitScriptä»å•ä¸€çš„UIåˆ†ææ–¹å¼å‡çº§ä¸ºæ™ºèƒ½çš„å¤šæ¨¡å¼æ£€æµ‹ç³»ç»Ÿã€‚å…³é”®æˆå°±åŒ…æ‹¬ï¼š

1. **æ¶æ„åˆ›æ–°**: è®¾è®¡äº†å¯æ‰©å±•çš„OCRæä¾›è€…æ¶æ„
2. **åŠŸèƒ½å®Œæ•´**: å®ç°äº†å®Œæ•´çš„UI+OCRåŒæ¨¡å¼æ£€æµ‹
3. **æ€§èƒ½ä¼˜åŒ–**: æœåŠ¡å™¨ç«¯å¤„ç†ä¿æŒå®¢æˆ·ç«¯è½»é‡
4. **æ˜“ç”¨æ€§**: æä¾›äº†ç®€æ´çš„APIå’Œè„šæœ¬æ¥å£
5. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºæœªæ¥æ‰©å±•

è¯¥ç³»ç»Ÿä¸ºç§»åŠ¨åº”ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•æä¾›äº†æ›´å¼ºå¤§ã€æ›´å¯é çš„æ–‡æœ¬æ£€æµ‹èƒ½åŠ›ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤æ‚UIåœºæ™¯å’Œå¤šè¯­è¨€ç¯å¢ƒã€‚

---

**å®Œæˆæ—¥æœŸ**: 2025å¹´5æœˆ30æ—¥  
**ç‰ˆæœ¬**: v2.0.0-dual-mode-ocr  
**ä¸‹ä¸€æ­¥**: è§£å†³PaddleOCRå…¼å®¹æ€§é—®é¢˜ï¼Œå®Œå–„æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹
