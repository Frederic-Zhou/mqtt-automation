name: advanced_dynamic_click
description: "高级动态坐标点击测试 - 包含错误处理和备选方案"
version: "3.0"

variables:
  primary_target: "设置"
  fallback_target: "浏览器"
  timeout_duration: 10

steps:
  - name: initial_screenshot
    type: screenshot
    description: "获取初始截图"
    timeout: "{{timeout_duration}}"

  - name: find_primary_target
    type: check_text
    text: "{{primary_target}}"
    description: "查找主要目标文本"
    timeout: "{{timeout_duration}}"
    output_vars:
      primary_found: "result"
      primary_x: "text_info[text='{{primary_target}}'].x"
      primary_y: "text_info[text='{{primary_target}}'].y"
    on_failure: "find_fallback_target"

  - name: click_primary_target
    type: tap
    x: "{{primary_x}}"
    y: "{{primary_y}}"
    description: "点击主要目标"
    timeout: 5
    condition: "primary_found"
    on_success: "success_screenshot"

  - name: find_fallback_target
    type: check_text
    text: "{{fallback_target}}"
    description: "查找备选目标文本"
    timeout: "{{timeout_duration}}"
    output_vars:
      fallback_found: "result"
      fallback_x: "text_info[text='{{fallback_target}}'].x"
      fallback_y: "text_info[text='{{fallback_target}}'].y"

  - name: click_fallback_target
    type: tap
    x: "{{fallback_x}}"
    y: "{{fallback_y}}"
    description: "点击备选目标"
    timeout: 5
    condition: "fallback_found"

  - name: success_screenshot
    type: screenshot
    description: "成功点击后的截图"
    timeout: "{{timeout_duration}}"

  - name: wait_for_response
    type: wait
    timeout: 3
    description: "等待页面响应"

  - name: final_screenshot
    type: screenshot
    description: "最终截图"
    timeout: "{{timeout_duration}}"
